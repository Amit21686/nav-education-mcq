<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NAV Education â€“ MCQ Test</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1e88e5">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #121212;
  color: #ffffff;
  text-align: center;
}
.container {
  max-width: 650px;
  margin: auto;
  padding: 20px;
}
input, button {
  padding: 10px;
  font-size: 16px;
  margin-top: 10px;
}
button {
  background: #1e88e5;
  color: white;
  border: none;
  border-radius: 6px;
}
.option {
  display: block;
  background: #1f1f1f;
  padding: 10px;
  margin: 8px 0;
  border-radius: 6px;
  text-align: left;
}
#timer { font-weight: bold; }
</style>
</head>

<body>

<h1>NAV Education</h1>

<div class="container">

<div id="start">
  <input id="name" placeholder="Enter your name">
  <br>
  <button onclick="start()">Start Test</button>
</div>

<div id="quiz" style="display:none;">
  <div id="timer"></div>
  <h3 id="q"></h3>
  <div id="opts"></div>
  <button onclick="next()">Next</button>
</div>

<div id="end" style="display:none;">
  <h2>Test Submitted</h2>
  <p>
    Your result is saved safely.<br>
    It will upload automatically when you open this app again
    while the server is online.
  </p>
</div>

</div>

<script>
/* ================= CONFIG ================= */

// CHANGE ONLY THIS (Termux server)
const SERVER_URL = "http://YOUR_TERMUX_IP:3000";

/* ================= QUESTIONS ================= */

const questions = [
  {
    q: "Human heart has how many chambers?",
    o: ["2","3","4","5"],
    a: 2
  },
  {
    q: "DNA full form?",
    o: ["Deoxyribo Nucleic Acid","Dioxy Acid","Dynamic Acid","None"],
    a: 0
  }
];

/* ================= VARIABLES ================= */

let i = 0, score = 0;
let time = 10 * 60;
let timer;

/* ================= QUIZ ================= */

function start() {
  const n = name.value.trim();
  if (!n) return alert("Enter name");

  localStorage.setItem("student", n);
  start.style.display = "none";
  quiz.style.display = "block";
  tick();
  show();
}

function tick() {
  timer = setInterval(() => {
    time--;
    timerDiv.innerText = `Time: ${time}s`;
    if (time <= 0) finish();
  }, 1000);
}

function show() {
  q.innerText = questions[i].q;
  opts.innerHTML = "";
  questions[i].o.forEach((x,j)=>{
    opts.innerHTML += `
      <label class="option">
        <input type="radio" name="o" value="${j}"> ${x}
      </label>`;
  });
}

function next() {
  const sel = document.querySelector("input[name=o]:checked");
  if (sel && Number(sel.value) === questions[i].a) score++;
  i++;
  if (i < questions.length) show();
  else finish();
}

function finish() {
  clearInterval(timer);
  quiz.style.display = "none";
  end.style.display = "block";

  saveOffline({
    name: localStorage.getItem("student"),
    score,
    time: (10*60 - time)
  });

  trySync();
}

/* ================= OFFLINE QUEUE ================= */

function saveOffline(data) {
  let q = JSON.parse(localStorage.getItem("queue")) || [];
  q.push(data);
  localStorage.setItem("queue", JSON.stringify(q));
}

/* ================= AUTO SYNC ================= */

function trySync() {
  let q = JSON.parse(localStorage.getItem("queue")) || [];
  if (!q.length) return;

  fetch(SERVER_URL + "/ping")
    .then(()=>{
      q.forEach(item=>{
        fetch(SERVER_URL,{
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body:JSON.stringify(item)
        }).then(()=>{
          q.shift();
          localStorage.setItem("queue",JSON.stringify(q));
        });
      });
    })
    .catch(()=>{});
}

window.addEventListener("load", trySync);
window.addEventListener("online", trySync);
</script>

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
</html>
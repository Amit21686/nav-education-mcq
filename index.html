
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NAV Education – MCQ Test</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1e88e5">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #121212;
  color: #ffffff;
  text-align: center;
}
.container {
  max-width: 650px;
  margin: auto;
  padding: 20px;
}
input, button {
  padding: 10px;
  font-size: 16px;
  margin-top: 10px;
}
button {
  background: #1e88e5;
  color: white;
  border: none;
  border-radius: 6px;
}
.option {
  display: block;
  background: #1f1f1f;
  padding: 10px;
  margin: 8px 0;
  border-radius: 6px;
  text-align: left;
}
#timer {
  font-weight: bold;
  margin-bottom: 10px;
}
</style>
</head>

<body>

<h1>NAV Education</h1>

<div class="container">

<!-- START -->
<div id="start">
  <input id="studentName" placeholder="Enter your name">
  <br>
  <button onclick="startQuiz()">Start Test</button>
</div>

<!-- QUIZ -->
<div id="quiz" style="display:none;">
  <div id="timer"></div>
  <h3 id="question"></h3>
  <div id="options"></div>
  <button onclick="nextQuestion()">Next</button>
</div>

<!-- END -->
<div id="end" style="display:none;">
  <h2>Test Submitted</h2>
  <p>
    Your result is saved safely.<br>
    It will upload automatically next time you open this app
    when the server is online.
  </p>
</div>

</div>

<script>
/* ================= CONFIG ================= */

// CHANGE ONLY THIS
const SERVER_URL = "http://YOUR_TERMUX_IP:3000";

/* ================= SETTINGS ================= */

const TOTAL_TIME = 10 * 60; // 10 minutes

/* ================= QUESTIONS ================= */

const questions = [
  {
    q: "Human heart has how many chambers?",
    o: ["2","3","4","5"],
    a: 2
  },
  {
    q: "DNA full form is?",
    o: [
      "Deoxyribo Nucleic Acid",
      "Dioxy Acid",
      "Dynamic Acid",
      "None"
    ],
    a: 0
  }
];

/* ================= VARIABLES ================= */

let index = 0;
let score = 0;
let timeLeft = TOTAL_TIME;
let timer = null;

/* ================= QUIZ LOGIC ================= */

function startQuiz() {
  if (timer) return;

  const name = document.getElementById("studentName").value.trim();
  if (!name) {
    alert("Enter your name");
    return;
  }

  localStorage.setItem("studentName", name);

  document.getElementById("start").style.display = "none";
  document.getElementById("quiz").style.display = "block";

  startTimer();
  showQuestion();
}

function startTimer() {
  updateTimer();
  timer = setInterval(() => {
    timeLeft--;
    updateTimer();
    if (timeLeft <= 0) finishQuiz();
  }, 1000);
}

function updateTimer() {
  document.getElementById("timer").innerText =
    `Time Left: ${timeLeft}s`;
}

function showQuestion() {
  const q = questions[index];
  document.getElementById("question").innerText = q.q;

  const optDiv = document.getElementById("options");
  optDiv.innerHTML = "";

  q.o.forEach((opt, i) => {
    optDiv.innerHTML += `
      <label class="option">
        <input type="radio" name="opt" value="${i}"> ${opt}
      </label>
    `;
  });
}

function nextQuestion() {
  const selected =
    document.querySelector("input[name='opt']:checked");

  if (selected && Number(selected.value) === questions[index].a) {
    score++;
  }

  index++;
  if (index < questions.length) {
    showQuestion();
  } else {
    finishQuiz();
  }
}

function finishQuiz() {
  clearInterval(timer);

  document.getElementById("quiz").style.display = "none";
  document.getElementById("end").style.display = "block";

  const result = {
    name: localStorage.getItem("studentName"),
    score: score,
    time: TOTAL_TIME - timeLeft,
    date: new Date().toISOString()
  };

  saveOffline(result);
  trySync();
}

/* ================= OFFLINE QUEUE ================= */

function saveOffline(data) {
  let queue = JSON.parse(localStorage.getItem("pendingQueue")) || [];
  queue.push(data);
  localStorage.setItem("pendingQueue", JSON.stringify(queue));
}

/* ================= AUTO SYNC ================= */

async function trySync() {
  let queue = JSON.parse(localStorage.getItem("pendingQueue")) || [];
  if (!queue.length) return;

  try {
    await fetch(SERVER_URL + "/ping");

    while (queue.length) {
      const item = queue[0];

      await fetch(SERVER_URL, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(item)
      });

      queue.shift();
      localStorage.setItem(
        "pendingQueue",
        JSON.stringify(queue)
      );
    }
  } catch (e) {
    // Server offline → wait
  }
}

window.addEventListener("load", trySync);
window.addEventListener("online", trySync);
</script>

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
</html>
